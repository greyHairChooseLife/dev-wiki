# 󰏢 CBPM 견적서 관리 웹앱 개발


## 개발 개요

#### 이용자

충북Pro메이커센터 직원 일동

#### 해결할 문제

- ('이용자'의 '고객사'가 내용변경 등 요청을 할 때) 최신버전이 무엇인지, 누구가 소유하고 있는지 파악이 어렵다.
- 견적서 수정 및 확정 시 담당자가 누구였는지 기록될 필요도 있다.

#### 문제 원인 분석

- 견적서를 발급하는 건 마다의 담당자 특별히 정해져있지 않고, 내용이 자주 변경된다.

#### 해결 방안

문제의 직접 원인은 상황 상 어찌할 수 없다. 따라서,

- 견적서가 한곳에 모일 수 있도록 한다.
- 견적서가 한곳에서 관리될 수 있도록 한다.
  - 관리: 추가/읽기/수정/삭제
- 견적서 관리를 위해 로그인한다.

#### 화면 구성

1. 로그인 페이지
2. 견적서 목록 페이지
3. 견적서 미리보기 및 수정 페이지
4. 명세서 목록 페이지


## 설계

### 유저 시나리오 [-]


### infra

> [!ye] 테스트 및 개발용 서버 구성은 생략한다. 워낙 간단한 프로젝트라서 로컬에서 즉시즉시 필요한 인프라를 구성해 활용한다.

> [!re] 실제 데이터가 저장되는 구글 드라이브는 일단 내걸 사용하고, 실사용시 충북Pro메이커센터의 구글 드라이브로 변경한다.

#### 배포 구조 구성

- DNS: AWS route53
- Front: AWS s3
- Back: AWS lambda, api gateway
- Login: AWS lamda 환경변수로 구현, 업데이트도 가능
- Database: (with GCP api)
  - 사용자별 권한, 견적서 상태: google sheet
  - static file: google drive


#### 사용자별 권한

| ID(이름)  | 권한                      |
|-----------|---------------------------|
| 곽준구    | Create/Read/Update/Delete |
| 이반석 등  | Create/Read/Update |
| 이재희    | Read/Record               |

- Create: 견적서 생성
- Read: 견적서 조회, 다운로드
- Update: 견적서 수정
- Delete: 견적서 삭제 _(*명세서 발급된 건은 명세서 발급 취소 전까지 삭제가 일체 불가능)_
- Record: 견적서 세금계산서 발행 및 입금 확인 기록


#### 견적서 상태(최신 상태를 반영)

| id     | 생성일   | 거래처명   | 최초 생성자       | 최근 수정일  | 최근 담당자       | 금액   |
| ----   | -------- | ---------- | ------------      | ------------ | ---               | ---    |
| number | date     | string     | string(user name) | date         | string(user name) | number |


#### 명세서 상태(최신 상태를 반영)

**(견적서 상태에 추가로)**

| id     | 결제 수단       | 세금계산서 발행 | (카드)결제/입금 확인 |
| ----   | ---             | ---             | ---                  |
| number | 카드/세금계산서 | T/F             | T/F                  |

- (카드)결제/입금 항목의 경우 _'결제 수단'이_
  - '카드'라면, 이 값을 변경할 수 있는 유저는 '최근 담당자' 뿐이다.
  - '세금계산서'라면, 이 값을 변경할 수 있는 유저는 '이재희' 뿐이다.


#### static file 구조

```javascript
`/${id}/${일시}_${담당자}.xlsx`
`/${id}/${일시}_${담당자}_명세서.xlsx`
/report.xlsx
```

_이 파일들은 최고관리자에게만 '수정 권한'이 주어지고, 그 외 일반 유저에겐 '보기/다운로드' 권한만 준다._


### 페이지별 상세 기능(함수)


#### 로그인 페이지

- 로그인
- 견적서 '견적서 삭제 권한' 있는 사람이 회원 '삭제 및 추가' 가능
  - 또는 회원관리 권한을


#### 견적서 목록 페이지

- 견적서 목록 보기
  - 특정 거래 '건' 선택(클릭)시 해당하는 견적서 업데이트 히스토리 조회
  - 명세서 발급 여부를 표시

- 새 견적서 생성
- '미리보기 및 수정' 페이지로 이동
- 명세서 발급(최신버전 기준으로 전환)
- pdf, xlsx 파일 다운로드


#### 견적서 미리보기 및 수정 페이지

- 견적서 미리보기
- 견적서 수정
  - 수정 가능 항목이 별도로 존재함
  - 수정 가능한 항목도 수정이 쉬운 항목과 여간해선 번거로운 항목으로 분리


#### 명세서 목록 페이지

- 견적서는 표시하지 않고 명세서만 표시
  - (명세서로 전환된)최근 견적서를 다운로드 할 수 있는 기능(버튼)만 제공
- 명세서 발급 취소: 생성된 명세서가 삭제되며, 최신 버전의 견적서로 다시 발급할 수 있다.
  - 명세서 발급 이후에 명세서 또는 견적서 수정이 필요한 상황
  - 발급당사자 및 Delete 권한이 있는 유저만 가능
  - 명세서 발급시 취소 전까지 견적서 등 삭제 불가능



## 디자인 [-]



## 사용자 교육

- 교내가 아니라도 접속 가능
- 비밀번호는 다른 개인정보와 겹치지 않도록 주의.
  (보안 관련 기술이 매우 낮은 수준으로 적용된 상태)
- 견적서 등 파일들이 저장된 구글 드라이브에서 파일을 직접 수정 및 이동하는 것은 자제하기.
  (다만 다운로드는 상관 없으니 폴더째로 다운받아 자유롭게 활용)




## 문제 [-]


> [!re] 해결하지 못한 문제, 우회할 방법을 찾아야겠다.
>
> 구글 드라이브 api를 사용하는데 문제가 있다. 프론트엔드에서 곧바로 호출하려는데, 관련된 라이브러리 중 쓸만한게 filepicker정도 뿐이다.
> 더 문제는 api로 간단히 접근하던 기존과 달리 OAuth 인증 방식으로만 가능해 보인다는 것이다. 정확한 것은 GCP의 안내를 참고해야 하지만, 그럴 시간까지는 당장 없다. 2024-11-20
>
> 아무래도 스태틱 파일은 s3에 저장하는 방식으로 해야겠다.
